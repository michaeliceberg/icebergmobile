import { FeedWrapper } from "@/components/feed-wrapper"
import { StickyWrapper } from "@/components/sticky-wrapper"
import { UserProgress } from "@/components/user-progress"
// import { Header } from "@/components/header"
import { TabCars } from "@/components/tab-cars"
import { Siren } from "lucide-react"
// import { getCarsData } from "@/app/_lib/readSheet"
import { getCars, getWorks } from "@/db/queries"
import { getCarsData } from "@/app/_lib/readSheet"
import { HeaderWGarageU } from "@/components/header-with-garage-update"
import { updateGarageOdometer } from "@/actions/update-garage-odometer"
// import { TgSendMsgCom } from "@/components/tg-send-message-com"


 const CarsPage = async () => {

    const googleCars = await getCarsData()

    // –ü–æ–ª—É—á–∞–µ–º –û–¥–æ–º–µ—Ç—Ä—ã –ò–∑ –ì—É–≥–ª–∞
    // –ê–ø–ª–æ–∞–¥–∏–º –∏—Ö –≤ Cars
    // –ì—Ä—É–∑–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Cars

    // —á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–æ–±–Ω–æ–≤–∏—Ç—å –û–î–û–ú–ï–¢–†–´" –∫–æ—Ç–æ—Ä–∞—è —Ç–æ–ª—å–∫–æ revalidate





    if (!googleCars) {
        throw new Error('–ù–µ—Ç –º–∞—à–∏–Ω –∏–∑ Google!');
    }


    const googleCarsObject = googleCars.map(el => {
        return (
            {
                id: +el[0],
                carNum: el[1],
                driver: el[2],
                odometer: el[4].replace(/\s/g, ''),
            }
        )
    })


    if (googleCarsObject.length > 0) {
        await updateGarageOdometer(googleCarsObject)
    }






    const dbCarsData = await getCars()
    const dbWorksData = await getWorks()

	const [
		dbCars,
		dbWorks,
	] = await Promise.all([
		dbCarsData,
		dbWorksData,		
	]);

   

    if (!dbCars) {
        throw new Error('–ù–µ—Ç –º–∞—à–∏–Ω!');
    }


   

    const carsObject = dbCars.map(el => {
        return (
            {
                id: el.id,
                carNum: el.carNum,
                driver: el.driver,
                type: el.type,
                odometer: el.odometer.replace(/\s/g, ''),
                to_prev: el.TOprev,
                // to_next: el.TOnext,
                next_to: dbWorks.filter(work => work.carId == el.id)[0]?.nextTO || "0",
                model: el.model,
            }
        )
    })


    // –°–û–†–¢–ò–†–£–ï–ú –ü–û –†–ê–ó–ù–ò–¶–ï      –ü–†–û–ë–ï–ì - –°–õ–ï–î –¢–û
    //
    carsObject.sort((a,b) => (Math.abs(+a.next_to - +a.odometer) > Math.abs(+b.next_to - +b.odometer)) 
    ? 1 
    : ((Math.abs(+b.next_to - +b.odometer) > Math.abs(+a.next_to - +a.odometer)) ? -1 : 0))


    



    // –°–û–†–¢–ò–†–û–í–ö–ê –ü–û –ê–õ–§–ê–í–ò–¢–£ –≥–æ—Å –ù–û–ú–ï–†–ê
    //
    // carsObject.sort(function(a, b) {
    //     const textA = a.carNum.toUpperCase();
    //     const textB = b.carNum.toUpperCase();
    //     return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;
    // });

    const all = carsObject.filter(el => el.odometer != '0')
    
    const mixers = carsObject.filter(el => el.type.toUpperCase()== '–ú' && el.odometer != '0')
    const tonars = carsObject.filter(el => el.type.toUpperCase() == '–¢' && el.odometer != '0')
    const samosv = carsObject.filter(el => el.type.toUpperCase() == '–°' && el.odometer != '0')
    const errCars = carsObject.filter(el => el.odometer == '0')


    const FourTypes = [all, samosv, tonars, mixers, errCars]

    // console.log(mixers)


    const NumCarsZeroOdometer = carsObject.filter(el => el.odometer == "0").length

    // console.log(NumCarsZeroOdometer)


    const message = `üö® ${errCars.length} –º–∞—à–∏–Ω —Å –ø—Ä–æ–±–µ–≥–æ–º 0 –∫–º`
    console.log(message)


    return(
        <div className="flex flex-row-reverse gap-[48px] px-6">
        {/* <div className="flex flex-row-reverse gap-[48px] pl-10"> */}
            <StickyWrapper>
                <UserProgress />
            </StickyWrapper>

            <FeedWrapper>



                {/* <TgSendMsgCom message={message} /> */}



                <HeaderWGarageU title='–ê–≤—Ç–æ–ø–∞—Ä–∫'/>

                {NumCarsZeroOdometer > 0 && 

                    <div className="flex mt-10 gap-2 border-2 border-yellow-400 border-dashed justify-center p-4 w-full rounded-xl">
                        <Siren  className='h-6 w-6 text-red-500'/>
                        <p className="pt-1">
                            {NumCarsZeroOdometer} –∞–≤—Ç–æ —Å –ø—Ä–æ–±–µ–≥–æ–º 0 –∫–º
                        </p>
                    </div>
                }
            

                <div className="mt-5 mb-5">
                    <TabCars FourTypes={FourTypes} dbWorks={dbWorks}/>
                </div>


            </FeedWrapper>
        </div>
    )
 }

 export default CarsPage













  // const cars = [

    //     [ '1', '–∞546–º–∫750', '–ê–≤—Ç–∞–µ–≤ –ê—é–± –î–∑–∞–º–∏—Ä–æ–≤–∏—á', '–¢', '489 492' ],
    //     [ '2', '—Å603—Ö–∫190', '', '–¢', '332242' ],
    //     [ '3', '–æ009—É—Ö190', '', '–°', '0' ],
    //     [ '4', '–∞534–Ω–Ω', '', '–¢', '0' ],
    //     [ '5', '–µ602—Å—Ç', '', '–°', '0' ],
    //     [ '6', '—Å285–≤–Ω790', '', '–ú', '0' ],
    //     [ '7', '–º473–∞—É790', '', '–°', '24568' ],
    //     [ '8', '–º549–∞—É790', '', '–ú', '49349' ],
    //     [ '9', '–µ654–∞—Å790', '', '–¢', '47422' ],
    //     [ '10', '–º609–∞—É790', '', '–°', '0' ],
    //     [ '11', '—É003–≤–∫790', '', '–¢', '55868' ],
    //     [ '12', '–º608–∞—É790', '–ö–æ—Ü–æ–µ–≤ –ú–∞—Ä–∞—Ç –í–∏—Ç–∞–ª—å–µ–≤–∏—á', '–°', '185 138' ],
    //     [ '13', '—Ö521–∞—É790', '', '–ú', '0' ],
    //     [ '14', '–º467–∞—É790', '', '–ú', '0' ],
    //     [ '15', '–º561–∞—É790', '', '–°', '0' ],
    //     [ '16', '–º584–∞—É790', '', '–¢', '0' ],
    //     [ '17', '—Ç750–≤–º790', '', '–ú', '0' ],
    //     [ '18', '—Ç724–≤–º790', '', '–ú', '40119' ],
    //     [ '19', '–º655–∞—É790', '', '–¢', '34431' ],
    //     [ '20', '—Å278–≤–Ω790', '', '–¢', '0' ],
    //     [ '21', '–º507–∞—É790', '–ï–ª–µ—Å–æ–≤ –†—É—Å—Ç–∞–º –†–∞–º–∑–∞–Ω–æ–≤–∏—á', '–ú', '201 177' ],
    //     [ '22', '—Å253–≤–Ω790', '', '–ú', '0' ],
    //     [ '23', '–º612–∞—É790', '–ù–∞–∑–∞—Ä–æ–≤ –®.–ù.', '–°', '0' ],
    //     [ '24', '—Å204–≤–Ω790', '', '–°', '0' ],
    //     [ '25', '–º412–∞—É790', '', '–°', '0' ],
    //     [ '26', '—Å301–≤–Ω790', '–•—É—à–ø–∞—Ä–æ–≤ –£—Å–º–∞–Ω –í–∏—Å–∏—Ç–æ–≤–∏—á', '–ú', '218 994' ],
    //     [ '27', '–º515–∞—É790', '', '–ú', '0' ],
    //     [ '28', '—Å264–≤–Ω790', '', '–ú', '0' ],
    //     [ '29', '–º644–∞—É790', '', '–°', '0' ],
    //     [ '30', '—Å306–≤–Ω790', '–ú–∞–π—Ä–∞–±–µ–∫–æ–≤ –ê–ª—Ö–∞–∑—É—Ä –õ–µ—á–∏–µ–≤–∏—á', '–°', '181 444' ],
    //     [ '31', '–º600–∞—É790', '', '–°', '0' ],
    //     [ '32', '—Å308–≤–Ω790', '', '–°', '0' ],
    //     [ '33', '–º606–∞—É790', '', '–°', '0' ],
    //     [
    //         '34',
    //         '—Å238–≤–Ω790',
    //         '–ö–∞—Ä–∏–±–æ–≤ –§–∏–∑–∏—É–ª–∏ –ù–∞—Å—Ä–∞–¥–¥–∏–Ω –û–≥–ª—ã',
    //         '–°',
    //         '204 417'
    //     ],
    //     [ '35', '—Å296–≤–Ω790', '', '–ú', '0' ],
    //     [ '36', '–º509–∞—É790', '', '–°', '32066' ],
    //     [ '37', '–º538–∞—É790', '', '–°', '0' ],
    //     [ '38', '–º615–∞—É790', '–•—É—à–ø–∞—Ä–æ–≤ –ê–ø—Ç–∏ –°—É–ª–µ–π–º–∞–Ω–æ–≤–∏—á', '–ú', '209 330' ],
    //     [ '39', '–º592–∞—É790', '', '–°', '0' ],
    //     [ '40', '–º558–∞—É790', '', '–°', '0' ],
    //     [ '41', '–≤896—Ä–∞750', '', '–ú', '0' ],
    //     [ '42', '–∞544–º–∫750', '', '–ú', '0' ],
    //     [ '43', '–º591–∞—É790', '', '–ù', '0' ],
    //     [ '44', '—É573–∫—É750', '', '–°', '348817' ],
    //     [ '45', '–∞540–º–∫750', '', '–¢', '0' ],
    //     [ '46', '–∫423—Ö–º190', '', '–°', '0' ],
    //     [ '47', '–∞426–∞–µ750', '', '–°', '504643' ],
    //     [ '48', '–µ687–∞—Å790', '', '–°', '46391' ],
    //     [ '49', '–º454–∞—É790', '', '–°', '0' ],
    //     [ '50', '–∫893—É–æ190', '', '–°', '0' ],
    //     [ '51', '—Ç782–≤–º790', '', '–ú', '34443' ],
    //     [ '52', '–µ438–∞—Å790', '', '–°', '35448' ],
    //     [ '53', '–∞562–º–∫750', '', '–¢', '0' ],
    //     [ '54', '–∞545–º–∫750', '–ö–µ—Ä–∏–º–æ–≤ –ê–ª—å–≤–∏ –ò—Å–∞–µ–≤–∏—á', '–ú', '457 492' ],
    //     [ '55', '–∫889—É–æ190', '', '–¢', '0' ],
    //     [ '56', '—Ä279–∫–µ750', '', '–°', '263599' ],
    //     [ '57', '—Ä280–∫–µ750', '', '–ú', '305362' ],
    //     [ '58', '—Ä281–∫–µ750', '', '–°', '193143' ],
    //     [ '59', '—Ä284–∫–µ750', '', '–°', '309326' ],
    //     [ '60', '—Ö169–µ–æ790', '', '–°', '0' ],
    //     [ '61', '—Ä283–∫–µ750', '', '–°', '320547' ],
    //     [ '62', '–Ω026—Ö–∞790', '', '–°', '0' ],
    //     [ '63', '–∞559–º–∫750', '–¢–µ–º–∏–Ω–æ–≤ –ú–∞—Ä–∞—Ç –†–∞—à–∏–¥–æ–≤–∏—á', '–¢', '475 645' ],
    //     [ '64', '—Å172—Ö–Ω790', '–ß—É–ø–∏–ª–æ–≤ –ê–Ω–¥—Ä–µ–π –Æ—Ä—å–µ–≤–∏—á', '–°', '123 078' ],
    //     [
    //         '65',
    //         '–Ω445—Ö–∫790',
    //         '–ú–∞—à—É–∫–∞–µ–≤ –°–∞–ª–∞–º–±–µ–∫ –ó–µ–ª–∏–º—Ö–∞–Ω–æ–≤–∏—á',
    //         '–ú',
    //         '112 310'
    //     ],
    //     [ '66', '–Ω419—Ö–∫790', '', '–°', '0' ],
    //     [ '67', '–Ω439—Ö–∫790', '–ó–æ—Ä–∏–Ω –ê–ª–µ–∫—Å–µ–π –°–µ—Ä–≥–µ–µ–≤–∏—á', '–ú', '134 260' ],
    //     [ '68', '–Ω456—Ö–∫790', '–ú–∞–ª—å—Ü–∞–≥–æ–≤ –†—É—Å–ª–∞–Ω –í–∞—Ö–∞–µ–≤–∏—á', '–ú', '102 127' ],
    //     [ '69', '–≤751–≤—Å790', '–ß—É–±–∫–∏–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–ª–µ–∫—Å–µ–µ–≤–∏—á', '–°', '244 510' ],
    //     [ '70', '—Ö520–∞—É790', '–§–∞–≥—Ä–∞–¥—è–Ω –ú–∞–Ω–≤–µ–ª –í–∞—Ä–∏—á–æ–≤–∏—á', '–ú', '366 726' ],
    //     [
    //         '71',
    //         '–≤864–≤—Å790',
    //         '–ú–∞–≥–æ–º–∞–¥–æ–≤ –¢–µ–º–∏—Ä–ª–∞–Ω –ë–ª–∞–≤–¥—è–µ–≤–∏—á',
    //         '–°',
    //         '256 828'
    //     ],
    //     [ '72', '–º410–≤—Ç790', '–ú–∏–ª–∞—à–µ–Ω–∫–æ –í–ª–∞–¥–∏–º–∏—Ä –ò–≤–∞–Ω–æ–≤–∏—á', '–¢', '413 568' ],
    //     [
    //         '73',
    //         '–≤736–≤—Å790',
    //         '–ú–∞–≥–∞–º–µ–¥—Ö–∞–¥–∂–∏–µ–≤ –†–∞—à–∏–¥ –†–∞–º–∞–∑–∞–Ω–æ–≤–∏—á',
    //         '–ú',
    //         '297 285'
    //     ],
    //     [ '74', '—Ç002–∞—Ö790', '', '–°', '0' ],
    //     [ '75', '–≤717–≤—Å790', '', '–ú', '0' ],
    //     [ '76', '–º411–≤—Ç790', '–ü–µ—Ç–∏—Ä–æ–≤ –ò–º—Ä–∞–Ω –ú—É—Ç–∞–ª–∏–ø–æ–≤–∏—á', '–ú', '419 049' ],
    //     [ '77', '—Ö580–∞—É790', '–î–∞—Ö–∞–µ–≤ –ê–±—É –°–∞–∏–¥–º—É—Ö–∞–º–µ—Ç–æ–≤–∏—á', '–ú', '275 689' ],
    //     [ '78', '–µ353–∫—Ç790', '–£–∑–±–µ–∫–æ–≤ –†–∞–≤–∏–ª—å –§–∞—Ä–∏—Ç–æ–≤–∏—á', '–°', '319 048' ],
    //     [ '79', '–≤793–≤—Å790', '–ê–ª–µ—Ö–∏–Ω –ù–∏–∫–æ–ª–∞–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á', '–ú', '318 483' ],
    //     [ '80', '–º427–≤—Ç790', '–ë—è–∑—Ä–æ–≤ –ê—Ä—Å–µ–Ω –ù–∞–∑–∏—Ä–æ–≤–∏—á', '–¢', '285 193' ],
    //     [ '81', '–≤818–≤—Å790', '–®–∞—Ö–º—É—Ä–∑–∞–µ–≤ –°–∞–∏–¥ –°–∞–ª–º–∞–Ω–æ–≤–∏—á', '–°', '366 090' ],
    //     [ '82', '–≤747–≤—Å790', '–ú–∞—Ö–º—É–¥–æ–≤ –ê–±—É –ú—É—Ö–º–∞–¥–æ–≤–∏—á', '–°', '249 923' ],
    //     [ '83', '–º448–≤—Ç790', '–ë–∞–π–º—É—Ä–∑–∞–µ–≤ –ê–Ω–∑–æ—Ä –ú—É—Ä–∞—Ç–æ–≤–∏—á', '–°', '273 534' ],
    //     [ '84', '—Ö500–∞—É790', '', '–¢', '0' ],
    //     [ '85', '–º414–≤—Ç790', '–ê—Ä—Å–∞–∫–∞–µ–≤ –ê—Å–ª–∞–º–±–µ–∫ –®—É–¥–¥–∏–Ω–æ–≤–∏—á', '–¢', '355 200' ],
    //     [
    //         '86',
    //         '—Ö517–∞—É790',
    //         '–ú—É—Ö—Ç–∞—Ä–æ–≤ –ê—Ö–º–µ–¥ –°–µ–ª–∏–º—Å–æ–ª—Ç–∞–µ–≤–∏—á',
    //         '–°',
    //         '256 088'
    //     ],
    //     [ '87', '–º335–≤—Ç790', '–ò–±—Ä–∞–≥–∏–º–æ–≤ –£–º–∞—Ä –ë–∞–π–∞–ª–∏–µ–≤–∏—á', '–¢', '470 284' ],
    //     [ '88', '–≤821–≤—Å790', '–ê—Ö–º–∞–¥–æ–≤ –®–∞–π—Ö–º–∞–≥–æ–º–µ–¥ –ú—É–∑–∞–µ–≤–∏—á', '–°', '221 794' ],
    //     [ '89', '–≤865–≤—Å790', '', '–ú', '0' ],
    //     [ '90', '–≤727–≤—Å790', '', '–°', '0' ],
    //     [ '91', '—Å054—Ö–º790', '', '–ú', '0' ],
    //     [ '92', '–º419–≤—Ç790', '', '–¢', '0' ],
    //     [ '93', '–µ274—Ö—Ö790', '–≠—Ö–∞–µ–≤ –ê–ø—Ç–∏ –í–∏—Å–∏—Ç–æ–≤–∏—á', '–°', '128 976' ],
    //     [ '94', '–∫118—Ä—É790', '', '–¢', '0' ],
    //     [ '95', '—É273—Ç–Ω790', '', '–°', '0' ],
    //     [ '96', '–≤160—Ç–Ω790', '', '–ú', '0' ],
    //     [ '97', '—Ö831–≤—Ä790', '', '–ú', '0' ],
    //     [ '98', '–º233—Ö–∫790', '', '–°', '0' ],
    //     [ '99', '—É267—Ç–Ω790', '–ë–∏–±—É–ª–∞—Ç–æ–≤ –†–∞—Å—É–ª –ì–µ–ª–∞–Ω–∏–µ–≤–∏—á', '–¢', '149 293' ],
    //     [ '100', '—Ö781–≤—Ä790', '', '–ú', '0' ]

    // ]
